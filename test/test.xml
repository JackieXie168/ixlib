<animation>
  <!--
    parameters used:
    
    state: stand,walk,jump,fly,land
    direction: 00,01,02,03,... 20, as if the clock had 20 hours
    weapon: none,bazooka
    model: mole
    -->
  <images>
    <image name="bazooka-d05" src="mole_bazooka_look_05.png"/>
    <image name="bazooka-d03" src="mole_bazooka_look_03.png"/>
    <image name="bazooka-d01" src="mole_bazooka_look_01.png"/>
    <image name="bazooka-d15" src="mole_bazooka_look_05.png" scale_x="-1"/>
    <image name="bazooka-d17" src="mole_bazooka_look_03.png" scale_x="-1"/>
    <image name="bazooka-d19" src="mole_bazooka_look_01.png" scale_x="-1"/>

    <!-- walking images ------------------------------------------------------>
    <image name="bazooka-d05-walk00" src="mole_bazooka_walk00_05.png"/>
    <image name="bazooka-d15-walk00" src="mole_bazooka_walk00_05.png" scale_x="-1"/>

    <!-- crouched images ----------------------------------------------------->
    <image name="bazooka-d05-crouch-1" src="mole_bazooka_look_05.png" scale_y="0.9"/>
    <image name="bazooka-d05-crouch-2" src="mole_bazooka_look_05.png" scale_y="0.85"/>
    <image name="bazooka-d15-crouch-1" src="mole_bazooka_look_05.png" scale_x="-1" scale_y="0.9"/>
    <image name="bazooka-d15-crouch-2" src="mole_bazooka_look_05.png" scale_x="-1" scale_y="0.85"/>
    </images>
  
  <regexes>
    <!-- normalize directions ---------------------------------------------- -->
    <regex original="d0[0-2]" replacement="d01"/>
    <regex original="d0[3-4]" replacement="d03"/>
    <regex original="d0[5-9]" replacement="d05"/>
    <regex original="d1[1-5]" replacement="d15"/>
    <regex original="d1[6-7]" replacement="d17"/>
    <regex original="d1[7-9]" replacement="d19"/>

    <!-- jump -------------------------------------------------------------- -->
    <regex original="d0.-prejump" replacement="d05-crouch"/>
    <regex original="d1.-prejump" replacement="d15-crouch"/>
    <regex original="d0.-jump" replacement="d01"/>
    <regex original="d1.-jump" replacement="d19"/>

    <!-- land -------------------------------------------------------------- -->
    <regex original="d0.-land" replacement="d05-crouch"/>
    <regex original="d1.-land" replacement="d15-crouch"/>

    <!-- walk -------------------------------------------------------------- -->
    <regex original="d0.-walk" replacement="d05-walk"/>
    <regex original="d1.-walk" replacement="d15-walk"/>
    </regexes>
  
  <script>
    <!-- direction set handler --------------------------------------------- -->
    <on parameter="direction" will_return>
      <return kill_delay/>
      </on>

    <!-- land handler ------------------------------------------------------ -->
    <on parameter="state" new="land" will_return>
      <priority push/>
      <priority value="5"/>
      <frame name="$(weapon)-d$(direction)-land-1"/>
      <delay time="30"/>
      <frame name="$(weapon)-d$(direction)-land-2"/>
      <delay time="30"/>
      <frame name="$(weapon)-d$(direction)-land-1"/>
      <delay time="30"/>
      <priority pop/>
      <return kill_delay/>
      </on>

    <!-- prejump handler --------------------------------------------------- -->
    <on parameter="state" new="prejump" will_return priority="10">
      <frame name="$(weapon)-d$(direction)-prejump-1"/>
      <delay time="30"/>
      <label name="prejump_loop"/>
      <frame name="$(weapon)-d$(direction)-prejump-2"/>
      <delay time="10000"/>
      <goto target="prejump_loop"/>
      <stop/>
      </on>
      
    <!-- jump handler ------------------------------------------------------ -->
    <on parameter="state" new="jump" priority="10">
      <frame name="$(weapon)-d$(direction)-prejump-1"/>
      <delay time="30"/>
      
      <signal name="jump"/>
      
      <priority push/>
      <priority value="5"/>
      <frame name="$(weapon)-d$(direction)-jump"/>
      <delay time="400"/>
      <priority pop/>
      
      <return kill_delay/>
      </on>

    <!-- walk handler ------------------------------------------------------ -->
    <on parameter="state" new="walk">
      <label name="walk_loop"/>
      <frame name="$(weapon)-d$(direction)"/>
      <delay time="150"/>
      <frame name="$(weapon)-d$(direction)-walk00"/>
      <delay time="150"/>
      <goto target="walk_loop"/>
      </on>

    <!-- main handler ------------------------------------------------------ -->
    <on parameter="state" new="stand">
      <goto target="main_loop"/>
      </on>

    <on parameter="state" new="fly">
      <goto target="main_loop"/>
      </on>
    
    <label name="main_loop"/>
    <frame name="$(weapon)-d$(direction)"/>
    <delay time="10000"/>
    <goto target="main_loop"/>
    </script>
  </animation>